{% extends "base.html" %}
{% block title %}
    Shows
{% endblock %}
{%block content%}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <div class="h1 text-center"> Book Shows </div>
    {% for venue in data %}
        <div class="card w-75 h-100 mx-auto my-5" style="height: 180px; border-radius: 20px;">
            <div class="card-body p-3">
                <div class="row">
                    <h2 class="col-sm-12 card-title text-center">{{venue.Venue}}</h2>
                </div>
                <div class="d-flex justify-content-around ">
                        {% for show in venue.Movies %}
                            <div class="card h6 p-4 text-center">
                                    <span> {{show.Name}} </span>
                                    <span> {{show.Date}} </span>
                                    <span> {{show.Time}} </span>
                                    {% if show.Tickets == 0 %}
                                        <a role="button" class="btn btn-outline-secondary mt-3 disabled">Houseful</a>
                                    {% else %}
                                    <a type="button" id="modal-open" class="open-BookingModal btn btn-outline-primary mt-3" href="#bookingmodal" data-movie="{{dump(show)}}" data-venue="{{dump(venue)}}">Book</a>
                                    {% endif %}
                            </div>
                        {% endfor %}
                </div>
            </div>
        </div>
    {% endfor %}
  <!-- Modal -->
  <div class="modal fade" id="bookingmodal">
    <div class="modal-dialog modal-dialog-centered d-flex justify-content-center">
      <div class="modal-content w-100">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Book Tickets</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
  
        <!-- Modal body -->
        <div class="modal-body p-4">
            <table class="table mb-5">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Venue</th>
                        <th>Hall</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="movId"></td>
                        <td id="movTitle"></td>
                        <td id="movDate"></td>
                        <td id="movTime"></td>
                        <td id="movVenue"></td>
                        <td id="movHall"></td>
                    </tr>
                </tbody>
            </table>
        <form>
            <div>
                <!-- Name of the person booking the ticket -->
                
                <!-- Number of Tickets with an add and a subtract button -->
                <div class="form-group d-flex">
                    <label for="InputNumTicket" class="h5 col-sm-9" >Number of Tickets</label>
                    <div class="input-group ">
                        <button class="btn btn-outline-danger" type="button" onclick="rem()">-</button>
                        <input type="text" value="1" id="numTkt" class="form-control text-center" aria-label="Example text with button addon" aria-describedby="button-addon" style="max-width: 50px;">     
                        <button class="btn btn-outline-success" type="button" onclick="add()">+</button>
                    </div>
                </div><br>
                <!-- Price of ticket -->
                <div class="form-group d-flex mb-5">
                    <label class="h5 col-sm-3">Price Rs.</label>
                    <label class="h5 col-sm-2" id="movPrice"></label>
                    <label for="totalPrice" class="h5 col-sm-4">Total</label>
                    <input type="text" class="form-control col-sm-4" id="TotalPrice" value="Rs. " style="max-width: 112px;" disabled>
                </div>


              <!-- Submit button -->
              <button type="submit" class="bookconfirm btn btn-primary btn-block col-12" >Confirm Booking</button>

            </div>
          </form>
        </div>
  
      </div>
    </div>
  </div>

  <script>
    function add() {
      var numTkt = document.getElementById("numTkt").value;
      var price = Number(document.getElementById("movPrice").innerHTML);
      if(numTkt < 10){
        numTkt++;
        document.getElementById("numTkt").value = numTkt;
        document.getElementById("TotalPrice").value = "Rs. " + numTkt * price;
      }
    }

    function rem() {
      var numTkt = document.getElementById("numTkt").value;
      var price = Number(document.getElementById("movPrice").innerHTML);
      if (numTkt > 1) {
        numTkt--;
        document.getElementById("numTkt").value = numTkt;
        document.getElementById("TotalPrice").value = "Rs. " + numTkt * price;
      }
    }

    $(document).on("click",".open-BookingModal",function(e){
        e.preventDefault();
        var _self = $(this);
        var movie = _self.data('movie');
        var venue = _self.data('venue');
        $("#movId").text(movie.id);
        $("#movTitle").text(movie.Name);
        $("#movDate").text(movie.Date);
        $("#movTime").text(movie.Time);
        $("#movPrice").text(movie.Price);
        $("#movVenue").text(venue.Venue);
        $("#movPlace").text(venue.Place);
        $("#movHall").text(movie.Hall);
        var numTkt = document.getElementById("numTkt").value;
        var price = Number(document.getElementById("movPrice").innerHTML);
        document.getElementById("TotalPrice").value = "Rs. " + numTkt * price;
        $(_self.attr('href')).modal('show');
    })

    $(document).on("click",".bookconfirm",function(e){
        e.preventDefault();
        var numTkt = document.getElementById("numTkt").value;
        var price = Number(document.getElementById("movPrice").innerHTML);
        var movTitle = document.getElementById("movTitle").innerHTML;
        var movDate = document.getElementById("movDate").innerHTML;
        var movTime = document.getElementById("movTime").innerHTML;
        var movVenue = document.getElementById("movVenue").innerHTML;
        var movHall = document.getElementById("movHall").innerHTML;
        var movId = document.getElementById("movId").innerHTML;
        var totalPrice = Number(numTkt) * price;
        var data = {
            "movId": movId,
            "numTkt": numTkt,
            "totalPrice": totalPrice
        }
        console.log(data);
        
    });
  </script>    
  

{% endblock %}